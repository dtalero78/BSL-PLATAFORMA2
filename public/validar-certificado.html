<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Validar Certificado Médico - BSL</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: #F3F3F3;
            min-height: 100vh;
            padding: 0;
            color: #181818;
        }

        .container {
            max-width: 700px;
            margin: 0 auto;
            padding: 40px 20px;
            min-height: 100vh;
        }

        /* Logo */
        .logo {
            margin-bottom: 40px;
            text-align: center;
        }

        .logo-img {
            max-height: 80px;
            width: auto;
        }

        /* Header */
        .page-header {
            text-align: center;
            margin-bottom: 40px;
        }

        .page-title {
            font-size: 32px;
            font-weight: 600;
            color: #1F2937;
            margin-bottom: 8px;
        }

        .page-subtitle {
            font-size: 16px;
            color: #6B7280;
            line-height: 1.5;
        }

        /* Search Card */
        .search-card {
            background: white;
            border-radius: 12px;
            padding: 32px;
            margin-bottom: 32px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        .form-group {
            margin-bottom: 24px;
        }

        .form-label {
            display: block;
            font-size: 14px;
            font-weight: 500;
            color: #374151;
            margin-bottom: 8px;
        }

        .form-input {
            width: 100%;
            padding: 12px 16px;
            border: 1px solid #E5E7EB;
            border-radius: 8px;
            font-size: 16px;
            font-family: inherit;
            color: #1F2937;
            transition: border-color 0.2s;
        }

        .form-input:focus {
            outline: none;
            border-color: #0176D3;
            box-shadow: 0 0 0 3px rgba(1, 118, 211, 0.1);
        }

        .btn-search {
            width: 100%;
            padding: 14px 24px;
            background: #0176D3;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.2s;
            font-family: inherit;
        }

        .btn-search:hover {
            background: #0257A6;
        }

        .btn-search:active {
            background: #013E7C;
        }

        .btn-search:disabled {
            background: #D1D5DB;
            cursor: not-allowed;
        }

        /* Results */
        .result-card {
            background: white;
            border-radius: 12px;
            padding: 32px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            margin-bottom: 24px;
            display: none;
        }

        .result-card.show {
            display: block;
        }

        .result-success {
            border-left: 4px solid #10B981;
        }

        .result-error {
            border-left: 4px solid #EF4444;
        }

        .result-icon {
            width: 64px;
            height: 64px;
            margin: 0 auto 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
        }

        .result-icon.success {
            background: #D1FAE5;
            color: #10B981;
        }

        .result-icon.error {
            background: #FEE2E2;
            color: #EF4444;
        }

        .result-icon svg {
            width: 32px;
            height: 32px;
        }

        .result-title {
            font-size: 24px;
            font-weight: 600;
            text-align: center;
            margin-bottom: 24px;
            color: #1F2937;
        }

        .result-data {
            background: #F9FAFB;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 16px;
        }

        .result-row {
            display: flex;
            justify-content: space-between;
            padding: 12px 0;
            border-bottom: 1px solid #E5E7EB;
        }

        .result-row:last-child {
            border-bottom: none;
        }

        .result-label {
            font-weight: 500;
            color: #6B7280;
            font-size: 14px;
        }

        .result-value {
            font-weight: 600;
            color: #1F2937;
            text-align: right;
            font-size: 14px;
        }

        .result-message {
            text-align: center;
            color: #6B7280;
            font-size: 15px;
            line-height: 1.6;
        }

        .btn-retry {
            width: 100%;
            padding: 12px 24px;
            background: #6B7280;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: background 0.2s;
            font-family: inherit;
            margin-top: 16px;
        }

        .btn-retry:hover {
            background: #4B5563;
        }

        /* Loading */
        .loading {
            text-align: center;
            color: #6B7280;
            padding: 20px;
            display: none;
        }

        .loading.show {
            display: block;
        }

        .spinner {
            border: 3px solid #E5E7EB;
            border-top: 3px solid #0176D3;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 16px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Info box */
        .info-box {
            background: #EFF6FF;
            border: 1px solid #BFDBFE;
            border-radius: 8px;
            padding: 16px;
            margin-top: 24px;
            font-size: 14px;
            color: #1E40AF;
            line-height: 1.6;
        }

        .info-box strong {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
        }

        @media (max-width: 768px) {
            .container {
                padding: 20px 16px;
            }

            .page-title {
                font-size: 24px;
            }

            .search-card {
                padding: 24px;
            }

            .result-card {
                padding: 24px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="logo">
            <img src="https://static.wixstatic.com/media/9e67f0_ec76d8e31ea447e5955b10e0e1ab6b12~mv2.png"
                 alt="BSL Logo"
                 class="logo-img">
        </div>

        <div class="page-header">
            <h1 class="page-title">Validar Certificado Médico</h1>
            <p class="page-subtitle">
                Ingrese el número de documento para verificar la autenticidad<br>
                de un certificado médico ocupacional
            </p>
        </div>

        <div class="search-card">
            <form id="validationForm">
                <div class="form-group">
                    <label for="numeroId" class="form-label">Número de Documento</label>
                    <input
                        type="text"
                        id="numeroId"
                        name="numeroId"
                        class="form-input"
                        placeholder="Ej: 1234567890"
                        required
                        pattern="[0-9]+"
                        title="Ingrese solo números">
                </div>

                <button type="submit" class="btn-search" id="btnSearch">
                    Validar Certificado
                </button>
            </form>

            <div class="info-box">
                <strong>Información de privacidad:</strong>
                Los datos personales se muestran parcialmente ofuscados (Dan*** Tal***) para proteger la identidad del titular del certificado.
            </div>
        </div>

        <div class="loading" id="loading">
            <div class="spinner"></div>
            <p>Validando certificado...</p>
        </div>

        <!-- Resultado exitoso -->
        <div class="result-card result-success" id="resultSuccess">
            <div class="result-icon success">
                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                </svg>
            </div>
            <h2 class="result-title">Certificado Válido</h2>
            <div class="result-data" id="certificateData">
                <div class="result-row">
                    <span class="result-label">Paciente:</span>
                    <span class="result-value" id="nombrePaciente">-</span>
                </div>
                <div class="result-row">
                    <span class="result-label">Fecha de consulta:</span>
                    <span class="result-value" id="fechaConsulta">-</span>
                </div>
                <div class="result-row">
                    <span class="result-label">Exámenes realizados:</span>
                    <span class="result-value" id="examenes">-</span>
                </div>
            </div>
            <p class="result-message">
                Este certificado médico ocupacional ha sido validado correctamente en nuestra base de datos.
            </p>
            <button class="btn-retry" onclick="resetForm()">Validar otro certificado</button>
        </div>

        <!-- Resultado no encontrado -->
        <div class="result-card result-error" id="resultError">
            <div class="result-icon error">
                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                </svg>
            </div>
            <h2 class="result-title">Certificado No Encontrado</h2>
            <p class="result-message" id="errorMessage">
                No se encontró un certificado médico ocupacional para este número de documento.
                Verifique que el número esté correcto o contacte con BSL para más información.
            </p>
            <button class="btn-retry" onclick="resetForm()">Intentar de nuevo</button>
        </div>
    </div>

    <script>
        const form = document.getElementById('validationForm');
        const loading = document.getElementById('loading');
        const resultSuccess = document.getElementById('resultSuccess');
        const resultError = document.getElementById('resultError');
        const btnSearch = document.getElementById('btnSearch');

        form.addEventListener('submit', async (e) => {
            e.preventDefault();

            const numeroId = document.getElementById('numeroId').value.trim();

            if (!numeroId) {
                alert('Por favor ingrese un número de documento');
                return;
            }

            // Ocultar resultados previos
            resultSuccess.classList.remove('show');
            resultError.classList.remove('show');

            // Mostrar loading
            loading.classList.add('show');
            btnSearch.disabled = true;

            try {
                const response = await fetch(`/api/validar-certificado/${numeroId}`);
                const data = await response.json();

                // Ocultar loading
                loading.classList.remove('show');
                btnSearch.disabled = false;

                if (data.success && data.existe) {
                    // Certificado encontrado
                    document.getElementById('nombrePaciente').textContent = data.datos.nombre;
                    document.getElementById('fechaConsulta').textContent = data.datos.fechaConsulta;
                    document.getElementById('examenes').textContent = data.datos.examenes;
                    resultSuccess.classList.add('show');
                } else {
                    // Certificado no encontrado
                    document.getElementById('errorMessage').textContent =
                        data.message || 'No se encontró certificado médico para este documento';
                    resultError.classList.add('show');
                }
            } catch (error) {
                loading.classList.remove('show');
                btnSearch.disabled = false;

                document.getElementById('errorMessage').textContent =
                    'Error al validar el certificado. Por favor intente nuevamente.';
                resultError.classList.add('show');

                console.error('Error:', error);
            }
        });

        function resetForm() {
            resultSuccess.classList.remove('show');
            resultError.classList.remove('show');
            document.getElementById('numeroId').value = '';
            document.getElementById('numeroId').focus();
        }

        // Focus inicial en el campo de entrada
        document.getElementById('numeroId').focus();
    </script>
</body>
</html>
