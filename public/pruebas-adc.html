<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Pruebas ADC - BSL</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Figtree:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Figtree', sans-serif;
            background: #FFFFFF;
            min-height: 100vh;
            padding: 0;
            color: #333333;
            -webkit-font-smoothing: antialiased;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 40px 20px;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        /* Logo */
        .logo {
            margin-bottom: 40px;
            text-align: left;
        }

        .logo-img {
            max-height: 60px;
            width: auto;
        }

        /* Progress bar */
        .progress-container {
            width: 100%;
            height: 4px;
            background: #E5E7EB;
            border-radius: 2px;
            margin-bottom: 20px;
            overflow: hidden;
        }

        .progress-bar {
            height: 100%;
            background: #00B8E6;
            width: 0%;
            transition: width 0.3s ease;
        }

        /* Question counter */
        .question-counter {
            font-size: 14px;
            color: #00B8E6;
            font-weight: 600;
            margin-bottom: 40px;
        }

        /* Question slides */
        .question-slide {
            display: none;
            animation: fadeIn 0.4s ease-in-out;
            flex: 1;
        }

        .question-slide.active {
            display: flex;
            flex-direction: column;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .question-content {
            flex: 1;
            display: flex;
            flex-direction: column;
        }

        /* Question label */
        .question-label {
            font-size: 28px;
            font-weight: 600;
            color: #1F2937;
            margin-bottom: 32px;
            line-height: 1.3;
            display: block;
        }

        /* Options grid - 4 opciones en columna */
        .options-grid {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin-top: 8px;
        }

        /* Option cards */
        .option-card {
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 18px 24px;
            border: 2px solid #E5E7EB;
            border-radius: 12px;
            background: #FFFFFF;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 16px;
            font-weight: 500;
            color: #4B5563;
        }

        .option-card:hover {
            border-color: #00B8E6;
            background: #F0F9FF;
        }

        .option-card input {
            display: none;
        }

        .option-card.selected {
            border-color: #00B8E6;
            background: #E0F7FA;
            color: #00838F;
        }

        .option-card:active {
            transform: scale(0.98);
        }

        /* Patient info card */
        .patient-card {
            background: #F8FAFC;
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 24px;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .patient-avatar {
            width: 50px;
            height: 50px;
            border-radius: 25px;
            background: linear-gradient(135deg, #00B8E6, #0088AA);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            font-weight: 600;
            flex-shrink: 0;
        }

        .patient-info {
            flex: 1;
        }

        .patient-name {
            font-size: 17px;
            font-weight: 600;
            margin-bottom: 2px;
            color: #1F2937;
        }

        .patient-id {
            font-size: 14px;
            color: #6B7280;
        }

        /* Welcome screen */
        .welcome-screen {
            display: flex;
            flex-direction: column;
        }

        .welcome-screen.hidden {
            display: none;
        }

        .instructions-card {
            background: #F8FAFC;
            border-radius: 12px;
            padding: 24px;
            margin-bottom: 24px;
        }

        .instructions-card h2 {
            font-size: 22px;
            font-weight: 700;
            margin-bottom: 16px;
            color: #1F2937;
        }

        .instructions-card p {
            font-size: 16px;
            line-height: 1.6;
            color: #4B5563;
            margin-bottom: 12px;
        }

        .instructions-card ul {
            list-style: none;
            margin-top: 16px;
        }

        .instructions-card li {
            padding: 12px 0;
            border-bottom: 1px solid #E5E7EB;
            display: flex;
            align-items: flex-start;
            gap: 12px;
            font-size: 15px;
            line-height: 1.4;
            color: #4B5563;
        }

        .instructions-card li:last-child {
            border-bottom: none;
        }

        .instruction-number {
            width: 24px;
            height: 24px;
            border-radius: 12px;
            background: #00B8E6;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 13px;
            font-weight: 600;
            flex-shrink: 0;
        }

        .btn-primary {
            background: #00B8E6;
            color: white;
            border: none;
            border-radius: 12px;
            padding: 18px 32px;
            font-size: 17px;
            font-weight: 600;
            cursor: pointer;
            width: 100%;
            transition: all 0.15s ease;
            font-family: 'Figtree', sans-serif;
        }

        .btn-primary:hover {
            background: #0099C2;
        }

        .btn-primary:active {
            transform: scale(0.98);
        }

        .btn-primary:disabled {
            background: #C7C7CC;
            cursor: not-allowed;
        }

        /* Test screen */
        .test-screen {
            display: none;
            flex: 1;
            flex-direction: column;
        }

        .test-screen.active {
            display: flex;
        }

        /* Results screen */
        .results-screen {
            display: none;
            flex: 1;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
        }

        .results-screen.active {
            display: flex;
        }

        .results-icon {
            font-size: 80px;
            margin-bottom: 24px;
        }

        .results-title {
            font-size: 28px;
            font-weight: 700;
            color: #1F2937;
            margin-bottom: 12px;
        }

        .results-subtitle {
            font-size: 16px;
            color: #6B7280;
            margin-bottom: 32px;
        }

        /* Loading overlay */
        .loading-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(255, 255, 255, 0.9);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .loading-spinner {
            text-align: center;
        }

        .spinner {
            width: 48px;
            height: 48px;
            border: 4px solid #E5E7EB;
            border-top-color: #00B8E6;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 16px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Error state */
        .error-card {
            background: #FEF2F2;
            border: 1px solid #FCA5A5;
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 16px;
            display: none;
        }

        .error-card p {
            color: #DC2626;
            font-size: 15px;
        }

        /* WhatsApp button */
        .whatsapp-btn {
            position: fixed;
            bottom: 24px;
            right: 24px;
            width: 56px;
            height: 56px;
            border-radius: 28px;
            background: #25D366;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 28px;
            text-decoration: none;
            box-shadow: 0 4px 12px rgba(37, 211, 102, 0.4);
            z-index: 100;
        }

        /* Responsive */
        @media (max-width: 600px) {
            .container {
                padding: 24px 16px;
            }

            .question-label {
                font-size: 22px;
            }

            .logo-img {
                max-height: 50px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Logo -->
        <div class="logo">
            <img src="bsl-logo.png" alt="BSL Logo" class="logo-img">
        </div>

        <!-- Patient card -->
        <div class="patient-card" id="patientCard">
            <div class="patient-avatar" id="patientAvatar">--</div>
            <div class="patient-info">
                <div class="patient-name" id="patientName">Cargando...</div>
                <div class="patient-id" id="patientId">---</div>
            </div>
        </div>

        <!-- Error card -->
        <div class="error-card" id="errorCard">
            <p id="errorMessage"></p>
        </div>

        <!-- ========== PANTALLA DE BIENVENIDA ========== -->
        <div class="welcome-screen" id="welcomeScreen">
            <div class="instructions-card">
                <h2>Prueba Psicotecnica ADC</h2>
                <p>Esta prueba evalua aspectos de ansiedad, depresion y comportamiento. Es importante que respondas con sinceridad.</p>
                <ul>
                    <li>
                        <span class="instruction-number">1</span>
                        <span>Lee cada afirmacion con atencion</span>
                    </li>
                    <li>
                        <span class="instruction-number">2</span>
                        <span>Selecciona la opcion que mejor te describe</span>
                    </li>
                    <li>
                        <span class="instruction-number">3</span>
                        <span>No hay respuestas correctas o incorrectas</span>
                    </li>
                </ul>
            </div>

            <button class="btn-primary" id="startBtn">
                Comenzar Prueba
            </button>
        </div>

        <!-- ========== PANTALLA DE PRUEBA ========== -->
        <div class="test-screen" id="testScreen">
            <!-- Progress bar -->
            <div class="progress-container">
                <div class="progress-bar" id="progressBar"></div>
            </div>

            <!-- Question counter -->
            <div class="question-counter">
                <span id="currentQuestion">1</span> de <span id="totalQuestions">63</span>
            </div>

            <!-- Question slide -->
            <div class="question-slide active" id="questionSlide">
                <div class="question-content">
                    <label class="question-label" id="questionLabel">Pregunta...</label>
                    <div class="options-grid" id="optionsGrid">
                        <!-- Options will be generated dynamically -->
                    </div>
                </div>
            </div>
        </div>

        <!-- ========== PANTALLA DE RESULTADOS ========== -->
        <div class="results-screen" id="resultsScreen">
            <div class="results-icon">âœ…</div>
            <div class="results-title">Prueba Completada</div>
            <div class="results-subtitle">Tus respuestas han sido guardadas correctamente</div>
            <button class="btn-primary" id="continueBtn" style="max-width: 300px;">
                Continuar
            </button>
        </div>
    </div>

    <!-- Loading overlay -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-spinner">
            <div class="spinner"></div>
            <p>Guardando respuestas...</p>
        </div>
    </div>

    <!-- WhatsApp button -->
    <a href="https://api.whatsapp.com/send?phone=573008021701&text=Hola.%20Requiero%20soporte%20con%20la%20prueba%20ADC"
       target="_blank"
       class="whatsapp-btn">
        ðŸ’¬
    </a>

    <script>
        // ==========================================
        // CONFIGURACIÃ“N DE PREGUNTAS
        // ==========================================
        const preguntas = [
            { pregunta: 'Me ilusiona cada nuevo dia', campo: 'de08', opciones: ['De acuerdo', 'Medianamente de acuerdo', 'Medianamente en desacuerdo', 'En desacuerdo'] },
            { pregunta: 'Creo que el mundo me ha ofrecido pocas oportunidades', campo: 'de29', opciones: ['De acuerdo', 'Medianamente de acuerdo', 'Medianamente en desacuerdo', 'En desacuerdo'] },
            { pregunta: 'Soy un obstaculo en los planes de los que me rodean', campo: 'de03', opciones: ['De acuerdo', 'Medianamente de acuerdo', 'Medianamente en desacuerdo', 'En desacuerdo'] },
            { pregunta: 'Me siento una persona valiosa para los demas', campo: 'de04', opciones: ['De acuerdo', 'Medianamente de acuerdo', 'Medianamente en desacuerdo', 'En desacuerdo'] },
            { pregunta: 'Las cosas siempre me salen mal aunque me esfuerce', campo: 'de05', opciones: ['De acuerdo', 'Medianamente de acuerdo', 'Medianamente en desacuerdo', 'En desacuerdo'] },
            { pregunta: 'Con frecuencia me siento aislado de los demas', campo: 'de32', opciones: ['De acuerdo', 'Medianamente de acuerdo', 'Medianamente en desacuerdo', 'En desacuerdo'] },
            { pregunta: 'Siento que sera muy dificil cumplir mis metas', campo: 'de12', opciones: ['De acuerdo', 'Medianamente de acuerdo', 'Medianamente en desacuerdo', 'En desacuerdo'] },
            { pregunta: 'La tristeza me impide seguir adelante', campo: 'de06', opciones: ['De acuerdo', 'Medianamente de acuerdo', 'Medianamente en desacuerdo', 'En desacuerdo'] },
            { pregunta: 'Los demas tienen mas suerte que yo', campo: 'de33', opciones: ['De acuerdo', 'Medianamente de acuerdo', 'Medianamente en desacuerdo', 'En desacuerdo'] },
            { pregunta: 'Siento que la vida tiene cosas buenas para mi', campo: 'de13', opciones: ['De acuerdo', 'Medianamente de acuerdo', 'Medianamente en desacuerdo', 'En desacuerdo'] },
            { pregunta: 'Soy una carga para las demas personas', campo: 'de07', opciones: ['De acuerdo', 'Medianamente de acuerdo', 'Medianamente en desacuerdo', 'En desacuerdo'] },
            { pregunta: 'Se que podre resolver los problemas que se me presenten en el futuro', campo: 'de35', opciones: ['De acuerdo', 'Medianamente de acuerdo', 'Medianamente en desacuerdo', 'En desacuerdo'] },
            { pregunta: 'Considero que soy una persona valiosa', campo: 'de21', opciones: ['De acuerdo', 'Medianamente de acuerdo', 'Medianamente en desacuerdo', 'En desacuerdo'] },
            { pregunta: 'Soy poco importante para los demas', campo: 'de14', opciones: ['De acuerdo', 'Medianamente de acuerdo', 'Medianamente en desacuerdo', 'En desacuerdo'] },
            { pregunta: 'Me pasan mas cosas malas que a las otras personas', campo: 'de15', opciones: ['De acuerdo', 'Medianamente de acuerdo', 'Medianamente en desacuerdo', 'En desacuerdo'] },
            { pregunta: 'Lograre todo lo que me proponga', campo: 'de37', opciones: ['De acuerdo', 'Medianamente de acuerdo', 'Medianamente en desacuerdo', 'En desacuerdo'] },
            { pregunta: 'Poco a poco me he quedado sin amigos', campo: 'de16', opciones: ['De acuerdo', 'Medianamente de acuerdo', 'Medianamente en desacuerdo', 'En desacuerdo'] },
            { pregunta: 'Tengo poco optimismo acerca del manana', campo: 'de38', opciones: ['De acuerdo', 'Medianamente de acuerdo', 'Medianamente en desacuerdo', 'En desacuerdo'] },
            { pregunta: 'Cada dia es una nueva oportunidad para lograr lo que se quiere', campo: 'de40', opciones: ['De acuerdo', 'Medianamente de acuerdo', 'Medianamente en desacuerdo', 'En desacuerdo'] },
            { pregunta: 'Soy una persona con mucha energia', campo: 'de27', opciones: ['De acuerdo', 'Medianamente de acuerdo', 'Medianamente en desacuerdo', 'En desacuerdo'] },
            { pregunta: 'Todos a mi alrededor estan mejor que yo', campo: 'de20', opciones: ['De acuerdo', 'Medianamente de acuerdo', 'Medianamente en desacuerdo', 'En desacuerdo'] },
            { pregunta: 'Mis manos sudan de manera constante', campo: 'an07', opciones: ['De acuerdo', 'Medianamente de acuerdo', 'Medianamente en desacuerdo', 'En desacuerdo'] },
            { pregunta: 'Hago movimientos repetitivos con mis manos o pies', campo: 'an11', opciones: ['De acuerdo', 'Medianamente de acuerdo', 'Medianamente en desacuerdo', 'En desacuerdo'] },
            { pregunta: 'Me cuesta trabajo pensar con claridad debido a tantas preocupaciones', campo: 'an03', opciones: ['De acuerdo', 'Medianamente de acuerdo', 'Medianamente en desacuerdo', 'En desacuerdo'] },
            { pregunta: 'En general siento tranquilidad en mi vida', campo: 'an18', opciones: ['De acuerdo', 'Medianamente de acuerdo', 'Medianamente en desacuerdo', 'En desacuerdo'] },
            { pregunta: 'Generalmente siento angustia sin saber porque', campo: 'an19', opciones: ['De acuerdo', 'Medianamente de acuerdo', 'Medianamente en desacuerdo', 'En desacuerdo'] },
            { pregunta: 'Soy una persona de pocas preocupaciones', campo: 'an04', opciones: ['De acuerdo', 'Medianamente de acuerdo', 'Medianamente en desacuerdo', 'En desacuerdo'] },
            { pregunta: 'Me toma mucho tiempo iniciar actividades programadas', campo: 'an14', opciones: ['De acuerdo', 'Medianamente de acuerdo', 'Medianamente en desacuerdo', 'En desacuerdo'] },
            { pregunta: 'Con frecuencia siento que mi corazon palpita muy rapido', campo: 'an09', opciones: ['De acuerdo', 'Medianamente de acuerdo', 'Medianamente en desacuerdo', 'En desacuerdo'] },
            { pregunta: 'Siempre tengo miedo de que pase algo malo', campo: 'an20', opciones: ['De acuerdo', 'Medianamente de acuerdo', 'Medianamente en desacuerdo', 'En desacuerdo'] },
            { pregunta: 'Es dificil concentrarme porque pienso muchas cosas a la vez', campo: 'an05', opciones: ['De acuerdo', 'Medianamente de acuerdo', 'Medianamente en desacuerdo', 'En desacuerdo'] },
            { pregunta: 'Enfrento con facilidad los problemas que se presentan cotidianamente', campo: 'an36', opciones: ['De acuerdo', 'Medianamente de acuerdo', 'Medianamente en desacuerdo', 'En desacuerdo'] },
            { pregunta: 'Duermo tranquilamente la mayoria de las noches', campo: 'an26', opciones: ['De acuerdo', 'Medianamente de acuerdo', 'Medianamente en desacuerdo', 'En desacuerdo'] },
            { pregunta: 'Soy una persona tranquila la mayor parte del tiempo', campo: 'an31', opciones: ['De acuerdo', 'Medianamente de acuerdo', 'Medianamente en desacuerdo', 'En desacuerdo'] },
            { pregunta: 'Aunque lo intente, es dificil dejar de pensar en lo que me preocupa', campo: 'an22', opciones: ['De acuerdo', 'Medianamente de acuerdo', 'Medianamente en desacuerdo', 'En desacuerdo'] },
            { pregunta: 'Tiendo a aplazar las actividades que tengo pendientes', campo: 'an38', opciones: ['De acuerdo', 'Medianamente de acuerdo', 'Medianamente en desacuerdo', 'En desacuerdo'] },
            { pregunta: 'Constantemente siento que algunas partes de mi cuerpo tiemblan', campo: 'an27', opciones: ['De acuerdo', 'Medianamente de acuerdo', 'Medianamente en desacuerdo', 'En desacuerdo'] },
            { pregunta: 'Generalmente me siento tranquilo, incluso en situaciones dificiles', campo: 'an35', opciones: ['De acuerdo', 'Medianamente de acuerdo', 'Medianamente en desacuerdo', 'En desacuerdo'] },
            { pregunta: 'Cuando algo me preocupa, puedo controlar facilmente lo que pienso', campo: 'an23', opciones: ['De acuerdo', 'Medianamente de acuerdo', 'Medianamente en desacuerdo', 'En desacuerdo'] },
            { pregunta: 'Cuando algo me preocupa, cambia mi apetito', campo: 'an39', opciones: ['De acuerdo', 'Medianamente de acuerdo', 'Medianamente en desacuerdo', 'En desacuerdo'] },
            { pregunta: 'Siento que mi cuerpo se mantiene relajado, incluso en situaciones incomodas', campo: 'an30', opciones: ['De acuerdo', 'Medianamente de acuerdo', 'Medianamente en desacuerdo', 'En desacuerdo'] },
            { pregunta: 'La familia es muy importante para mi', campo: 'cofv01', opciones: ['De acuerdo', 'Medianamente de acuerdo', 'Medianamente en desacuerdo', 'En desacuerdo'] },
            { pregunta: 'Tener amigos es muy importante', campo: 'corv11', opciones: ['De acuerdo', 'Medianamente de acuerdo', 'Medianamente en desacuerdo', 'En desacuerdo'] },
            { pregunta: 'Dedico poco tiempo a compartir con mi familia', campo: 'cofc06', opciones: ['De acuerdo', 'Medianamente de acuerdo', 'Medianamente en desacuerdo', 'En desacuerdo'] },
            { pregunta: 'Es importante para mi mantenerme saludable', campo: 'coav21', opciones: ['De acuerdo', 'Medianamente de acuerdo', 'Medianamente en desacuerdo', 'En desacuerdo'] },
            { pregunta: 'Deseo ocuparme en algo que le de sentido a mi vida', campo: 'coov32', opciones: ['De acuerdo', 'Medianamente de acuerdo', 'Medianamente en desacuerdo', 'En desacuerdo'] },
            { pregunta: 'Siempre que pueda elijo la soledad', campo: 'corc16', opciones: ['De acuerdo', 'Medianamente de acuerdo', 'Medianamente en desacuerdo', 'En desacuerdo'] },
            { pregunta: 'Realizo actividad fisica con frecuencia', campo: 'coac26', opciones: ['De acuerdo', 'Medianamente de acuerdo', 'Medianamente en desacuerdo', 'En desacuerdo'] },
            { pregunta: 'Tengo poco interes en hacer planes con mi familia', campo: 'cofv02', opciones: ['De acuerdo', 'Medianamente de acuerdo', 'Medianamente en desacuerdo', 'En desacuerdo'] },
            { pregunta: 'Es importante invertir tiempo en actividades de aprendizaje', campo: 'coov34', opciones: ['De acuerdo', 'Medianamente de acuerdo', 'Medianamente en desacuerdo', 'En desacuerdo'] },
            { pregunta: 'La familia es un apoyo en tiempos dificiles', campo: 'cofv03', opciones: ['De acuerdo', 'Medianamente de acuerdo', 'Medianamente en desacuerdo', 'En desacuerdo'] },
            { pregunta: 'Desconozco las necesidades de mis amigos', campo: 'corc17', opciones: ['De acuerdo', 'Medianamente de acuerdo', 'Medianamente en desacuerdo', 'En desacuerdo'] },
            { pregunta: 'Realizo pocas actividades de entretenimiento', campo: 'coac27', opciones: ['De acuerdo', 'Medianamente de acuerdo', 'Medianamente en desacuerdo', 'En desacuerdo'] },
            { pregunta: 'Tomo decisiones sin contar con mi familia', campo: 'cofc08', opciones: ['De acuerdo', 'Medianamente de acuerdo', 'Medianamente en desacuerdo', 'En desacuerdo'] },
            { pregunta: 'Dedico tiempo a actividades que me aportan poco', campo: 'cooc39', opciones: ['De acuerdo', 'Medianamente de acuerdo', 'Medianamente en desacuerdo', 'En desacuerdo'] },
            { pregunta: 'Desconozco las necesidades de mi familia', campo: 'cofc10', opciones: ['De acuerdo', 'Medianamente de acuerdo', 'Medianamente en desacuerdo', 'En desacuerdo'] },
            { pregunta: 'Conocer nuevas personas es poco importante', campo: 'corv12', opciones: ['De acuerdo', 'Medianamente de acuerdo', 'Medianamente en desacuerdo', 'En desacuerdo'] },
            { pregunta: 'Llevo a cabo actividades orientadas a alcanzar mis planes', campo: 'cooc40', opciones: ['De acuerdo', 'Medianamente de acuerdo', 'Medianamente en desacuerdo', 'En desacuerdo'] },
            { pregunta: 'Es importante reconocer las cosas buenas de los demas', campo: 'corv15', opciones: ['De acuerdo', 'Medianamente de acuerdo', 'Medianamente en desacuerdo', 'En desacuerdo'] },
            { pregunta: 'Trato de que mi alimentacion diaria sea saludable', campo: 'coac29', opciones: ['De acuerdo', 'Medianamente de acuerdo', 'Medianamente en desacuerdo', 'En desacuerdo'] },
            { pregunta: 'Siento poco interes por llevar a cabo nuevos planes', campo: 'coov35', opciones: ['De acuerdo', 'Medianamente de acuerdo', 'Medianamente en desacuerdo', 'En desacuerdo'] },
            { pregunta: 'Es importante para mi tener un peso saludable', campo: 'coav24', opciones: ['De acuerdo', 'Medianamente de acuerdo', 'Medianamente en desacuerdo', 'En desacuerdo'] },
            { pregunta: 'Evito asistir a lugares en los que tengo que conocer nuevas personas', campo: 'corc18', opciones: ['De acuerdo', 'Medianamente de acuerdo', 'Medianamente en desacuerdo', 'En desacuerdo'] },
            { pregunta: 'Es saludable poder expresar lo que siento', campo: 'coav25', opciones: ['De acuerdo', 'Medianamente de acuerdo', 'Medianamente en desacuerdo', 'En desacuerdo'] }
        ];

        // ==========================================
        // ESTADO DE LA APLICACIÃ“N
        // ==========================================
        let currentIndex = 0;
        let respuestas = {};
        let patientData = null;
        let ordenId = null;

        // Elementos del DOM
        const welcomeScreen = document.getElementById('welcomeScreen');
        const testScreen = document.getElementById('testScreen');
        const resultsScreen = document.getElementById('resultsScreen');
        const loadingOverlay = document.getElementById('loadingOverlay');
        const errorCard = document.getElementById('errorCard');
        const progressBar = document.getElementById('progressBar');
        const currentQuestionSpan = document.getElementById('currentQuestion');
        const totalQuestionsSpan = document.getElementById('totalQuestions');
        const questionLabel = document.getElementById('questionLabel');
        const optionsGrid = document.getElementById('optionsGrid');

        // ==========================================
        // INICIALIZACIÃ“N
        // ==========================================
        document.addEventListener('DOMContentLoaded', async () => {
            // Obtener ordenId de la URL
            const urlParams = new URLSearchParams(window.location.search);
            ordenId = urlParams.get('ordenId');

            if (!ordenId) {
                showError('No se proporciono un ID de orden valido.');
                return;
            }

            // Actualizar total de preguntas
            totalQuestionsSpan.textContent = preguntas.length;

            // Cargar datos del paciente
            await loadPatientData();

            // Configurar eventos
            setupEventListeners();
        });

        async function loadPatientData() {
            try {
                const response = await fetch(`/api/historia-clinica/${ordenId}`);
                if (!response.ok) throw new Error('No se encontro la orden');

                const result = await response.json();

                if (!result.success || !result.data) {
                    throw new Error('Datos del paciente no disponibles');
                }

                patientData = result.data;

                // Actualizar UI
                const initials = ((patientData.primerNombre || '')[0] || '') + ((patientData.primerApellido || '')[0] || '');
                document.getElementById('patientAvatar').textContent = initials.toUpperCase();
                document.getElementById('patientName').textContent = `${patientData.primerNombre || ''} ${patientData.primerApellido || ''}`.trim() || 'Paciente';
                document.getElementById('patientId').textContent = `CC ${patientData.numeroId || '---'}`;

            } catch (error) {
                console.error('Error cargando paciente:', error);
                showError('No se pudo cargar la informacion del paciente. Verifique el enlace.');
            }
        }

        function setupEventListeners() {
            // BotÃ³n de inicio
            document.getElementById('startBtn').addEventListener('click', startTest);

            // BotÃ³n continuar
            document.getElementById('continueBtn').addEventListener('click', () => {
                // Redirigir a la audiometrÃ­a virtual
                window.location.href = `/audiometria-virtual.html?ordenId=${ordenId}`;
            });
        }

        // ==========================================
        // LÃ“GICA DE LA PRUEBA
        // ==========================================
        function startTest() {
            currentIndex = 0;
            respuestas = {};

            // Cambiar pantalla
            welcomeScreen.classList.add('hidden');
            testScreen.classList.add('active');

            // Mostrar primera pregunta
            showQuestion(currentIndex);
        }

        function showQuestion(index) {
            const pregunta = preguntas[index];

            // Actualizar progreso
            const progress = ((index + 1) / preguntas.length) * 100;
            progressBar.style.width = `${progress}%`;
            currentQuestionSpan.textContent = index + 1;

            // Actualizar pregunta
            questionLabel.textContent = pregunta.pregunta;

            // Generar opciones
            optionsGrid.innerHTML = '';
            pregunta.opciones.forEach((opcion, i) => {
                const optionCard = document.createElement('div');
                optionCard.className = 'option-card';
                optionCard.textContent = opcion;
                optionCard.addEventListener('click', () => selectOption(opcion));
                optionsGrid.appendChild(optionCard);
            });
        }

        function selectOption(opcion) {
            const pregunta = preguntas[currentIndex];

            // Guardar respuesta
            respuestas[pregunta.campo] = opcion;

            // Marcar como seleccionada brevemente
            const cards = document.querySelectorAll('.option-card');
            cards.forEach(card => {
                if (card.textContent === opcion) {
                    card.classList.add('selected');
                }
            });

            // Avanzar despuÃ©s de un breve delay
            setTimeout(() => {
                currentIndex++;
                if (currentIndex < preguntas.length) {
                    showQuestion(currentIndex);
                } else {
                    saveAllResponses();
                }
            }, 200);
        }

        // ==========================================
        // GUARDAR RESULTADOS
        // ==========================================
        async function saveAllResponses() {
            loadingOverlay.style.display = 'flex';

            const dataToSave = {
                orden_id: ordenId,
                numero_id: patientData?.numeroId || '',
                primer_nombre: patientData?.primerNombre || '',
                primer_apellido: patientData?.primerApellido || '',
                empresa: patientData?.empresa || '',
                cod_empresa: patientData?.codEmpresa || '',
                ...respuestas
            };

            try {
                const response = await fetch('/api/pruebas-adc', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(dataToSave)
                });

                if (!response.ok) throw new Error('Error guardando resultados');

                const result = await response.json();
                console.log('Resultados guardados:', result);

                // Mostrar pantalla de resultados
                showResults();

            } catch (error) {
                console.error('Error guardando:', error);
                showError('Error guardando los resultados. Por favor contacte soporte.');
            } finally {
                loadingOverlay.style.display = 'none';
            }
        }

        function showResults() {
            testScreen.classList.remove('active');
            resultsScreen.classList.add('active');
        }

        // ==========================================
        // UTILIDADES
        // ==========================================
        function showError(message) {
            errorCard.style.display = 'block';
            document.getElementById('errorMessage').textContent = message;
            document.getElementById('startBtn').disabled = true;
        }
    </script>
</body>
</html>
